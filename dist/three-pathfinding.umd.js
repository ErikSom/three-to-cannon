!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("cannon-es")):"function"==typeof define&&define.amd?define(["exports","cannon-es"],t):t(e.threeToCannon={},e.cannonEs)}(this,function(e,t){var n=function(){var e,t,n,r,o,i,s,a,u,c,f,m,d,l,p,x,y,E,h,g=[],v=[],w=0,T=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(r,o,i){return e.subVectors(i,r),t.subVectors(o,r),n.crossVectors(e,t),n.normalize()}}();function b(e,t){if(void 0!==e.normal)return e.normal;var n=t[e[0]],r=t[e[2]];return f.subVectors(t[e[1]],n),m.subVectors(r,n),p.crossVectors(m,f),p.normalize(),e.normal=p.clone()}function V(e,t,n){var r=n[e[0]],o=[],i=b(e,n);t.sort(function(e,t){return o[e.x/3]=void 0!==o[e.x/3]?o[e.x/3]:i.dot(d.subVectors(e,r)),o[t.x/3]=void 0!==o[t.x/3]?o[t.x/3]:i.dot(l.subVectors(t,r)),o[e.x/3]-o[t.x/3]});var s=t.length;for(1===s&&(o[t[0].x/3]=i.dot(d.subVectors(t[0],r)));s-- >0&&o[t[s].x/3]>0;);s+1<t.length&&o[t[s+1].x/3]>0&&(e.visiblePoints=t.splice(s+1))}function R(e,t){for(var n,r=g.length,o=[e],i=t.indexOf(e.visiblePoints.pop());r-- >0;)(n=g[r])!==e&&b(n,t).dot(x.subVectors(t[i],t[n[0]]))>0&&o.push(n);var s,a,u,c,f=r=o.length,m=1===r,d=[],l=0,p=[];if(1===o.length)d=[(n=o[0])[0],n[1],n[1],n[2],n[2],n[0]],v.indexOf(n)>-1&&v.splice(v.indexOf(n),1),n.visiblePoints&&(p=p.concat(n.visiblePoints)),g.splice(g.indexOf(n),1);else for(;r-- >0;){var y;for(v.indexOf(n=o[r])>-1&&v.splice(v.indexOf(n),1),n.visiblePoints&&(p=p.concat(n.visiblePoints)),g.splice(g.indexOf(n),1),cEdgeIndex=0;cEdgeIndex<3;){for(y=!1,f=o.length,u=n[cEdgeIndex],c=n[(cEdgeIndex+1)%3];f-- >0&&!y;)if(l=0,(s=o[f])!==n)for(;l<3&&!y;)a=l+1,y=s[l]===u&&s[a%3]===c||s[l]===c&&s[a%3]===u,l++;y&&!m||(d.push(u),d.push(c)),cEdgeIndex++}}r=0;for(var E,h=d.length/2;r<h;)V(E=[d[2*r+1],i,d[2*r]],p,t),g.push(E),void 0!==E.visiblePoints&&v.push(E),r++}var H=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(r,o,i){e.subVectors(o,r),t.subVectors(i,r),n.subVectors(i,o);var s=t.dot(e);if(s<0)return t.dot(t);var a=e.dot(e);return s>=a?n.dot(n):t.dot(t)-s*s/a}}();return function(b){for(f=new THREE.Vector3,m=new THREE.Vector3,new THREE.Vector3,d=new THREE.Vector3,l=new THREE.Vector3,p=new THREE.Vector3,x=new THREE.Vector3,y=new THREE.Vector3,E=new THREE.Vector3,h=new THREE.Vector3,points=b.vertices,g=[],v=[],M=e=points.length,t=points.slice(0,6),w=0;M-- >0;)points[M].x<t[0].x&&(t[0]=points[M]),points[M].x>t[1].x&&(t[1]=points[M]),points[M].y<t[2].y&&(t[2]=points[M]),points[M].y<t[3].y&&(t[3]=points[M]),points[M].z<t[4].z&&(t[4]=points[M]),points[M].z<t[5].z&&(t[5]=points[M]);for(r=M=6;M-- >0;)for(r=M-1;r-- >0;)w<(n=t[M].distanceToSquared(t[r]))&&(w=n,o=t[M],i=t[r]);for(M=6,w=0;M-- >0;)n=H(o,i,t[M]),w<n&&(w=n,s=t[M]);for(u=T(o,i,s),c=u.dot(o),w=0,M=e;M-- >0;)n=Math.abs(points[M].dot(u)-c),w<n&&(w=n,a=points[M]);var B=points.indexOf(o),z=points.indexOf(i),S=points.indexOf(s),O=points.indexOf(a),G=[[S,z,B],[z,O,B],[S,O,z],[B,O,S]];y.subVectors(i,o).normalize(),E.subVectors(s,o).normalize(),h.subVectors(a,o).normalize(),h.dot((new THREE.Vector3).crossVectors(E,y))<0&&(G[0].reverse(),G[1].reverse(),G[2].reverse(),G[3].reverse());var C=points.slice();C.splice(C.indexOf(o),1),C.splice(C.indexOf(i),1),C.splice(C.indexOf(s),1),C.splice(C.indexOf(a),1);for(var M=G.length;M-- >0;)V(G[M],C,points),void 0!==G[M].visiblePoints&&v.push(G[M]),g.push(G[M]);!function(e){for(;v.length>0;)R(v.shift(),e)}(points);for(var P=g.length;P-- >0;)b.faces[P]=new THREE.Face3(g[P][2],g[P][1],g[P][0],g[P].normal);return b.normalsNeedUpdate=!0,b}}(),r=Math.PI/2,o={BOX:"Box",CYLINDER:"Cylinder",SPHERE:"Sphere",HULL:"ConvexPolyhedron",MESH:"Trimesh"},i=function(e,i){var f;if((i=i||{}).type===o.BOX)return a(e);if(i.type===o.CYLINDER)return function(e,n){var o,i,s,a=new THREE.Box3,u=["x","y","z"],c=n.cylinderAxis||"y",f=u.splice(u.indexOf(c),1)&&u;return a.setFromObject(e),isFinite(a.min.lengthSq())?(i=a.max[c]-a.min[c],s=.5*Math.max(a.max[f[0]]-a.min[f[0]],a.max[f[1]]-a.min[f[1]]),(o=new t.Cylinder(s,s,i,12))._type=t.Shape.types.CYLINDER,o.radiusTop=s,o.radiusBottom=s,o.height=i,o.numSegments=12,o.orientation=new t.Quaternion,o.orientation.setFromEuler("y"===c?r:0,"z"===c?r:0,0,"XYZ").normalize(),o):null}(e,i);if(i.type===o.SPHERE)return function(e,n){if(n.sphereRadius)return new t.Sphere(n.sphereRadius);var r=u(e);return r?(r.computeBoundingSphere(),new t.Sphere(r.boundingSphere.radius)):null}(e,i);if(i.type===o.HULL)return function(e){var r,o,i,s,a=u(e);if(!a||!a.vertices.length)return null;for(r=0;r<a.vertices.length;r++)a.vertices[r].x+=1e-4*(Math.random()-.5),a.vertices[r].y+=1e-4*(Math.random()-.5),a.vertices[r].z+=1e-4*(Math.random()-.5);for(s=n(a),o=new Array(s.vertices.length),r=0;r<s.vertices.length;r++)o[r]=new t.Vec3(s.vertices[r].x,s.vertices[r].y,s.vertices[r].z);for(i=new Array(s.faces.length),r=0;r<s.faces.length;r++)i[r]=[s.faces[r].a,s.faces[r].b,s.faces[r].c];return new t.ConvexPolyhedron(o,i)}(e);if(i.type===o.MESH)return(f=u(e))?function(e){var n,r=c(e);return r.length?(n=Object.keys(r).map(Number),new t.Trimesh(r,n)):null}(f):null;if(i.type)throw new Error('[CANNON.threeToCannon] Invalid type "%s".',i.type);if(!(f=u(e)))return null;switch(f.metadata?f.metadata.type:f.type){case"BoxGeometry":case"BoxBufferGeometry":return s(f);case"CylinderGeometry":case"CylinderBufferGeometry":return function(e){var n,r=e.metadata?e.metadata.parameters:e.parameters;return(n=new t.Cylinder(r.radiusTop,r.radiusBottom,r.height,r.radialSegments))._type=t.Shape.types.CYLINDER,n.radiusTop=r.radiusTop,n.radiusBottom=r.radiusBottom,n.height=r.height,n.numSegments=r.radialSegments,n.orientation=new t.Quaternion,n.orientation.setFromEuler(THREE.Math.degToRad(90),0,0,"XYZ").normalize(),n}(f);case"PlaneGeometry":case"PlaneBufferGeometry":return function(e){e.computeBoundingBox();var n=e.boundingBox;return new t.Box(new t.Vec3((n.max.x-n.min.x)/2||.1,(n.max.y-n.min.y)/2||.1,(n.max.z-n.min.z)/2||.1))}(f);case"SphereGeometry":case"SphereBufferGeometry":return function(e){return new t.Sphere((e.metadata?e.metadata.parameters:e.parameters).radius)}(f);case"TubeGeometry":case"Geometry":case"BufferGeometry":return a(e);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',f.type),s(f)}};function s(e){if(!c(e).length)return null;e.computeBoundingBox();var n=e.boundingBox;return new t.Box(new t.Vec3((n.max.x-n.min.x)/2,(n.max.y-n.min.y)/2,(n.max.z-n.min.z)/2))}function a(e){var n,r,o=new THREE.Box3,i=e.clone();return i.quaternion.set(0,0,0,1),i.updateMatrixWorld(),o.setFromObject(i),isFinite(o.min.lengthSq())?(n=new t.Box(new t.Vec3((o.max.x-o.min.x)/2,(o.max.y-o.min.y)/2,(o.max.z-o.min.z)/2)),(r=o.translate(i.position.negate()).getCenter(new THREE.Vector3)).lengthSq()&&(n.offset=r),n):null}function u(e){var t,n,r=function(e){var t=[];return e.traverse(function(e){"Mesh"===e.type&&t.push(e)}),t}(e),o=new THREE.Geometry,i=new THREE.Geometry;if(0===r.length)return null;if(1===r.length){var s=new THREE.Vector3,a=new THREE.Quaternion,u=new THREE.Vector3;return r[0].geometry.isBufferGeometry?r[0].geometry.attributes.position&&r[0].geometry.attributes.position.itemSize>2&&o.fromBufferGeometry(r[0].geometry):o=r[0].geometry.clone(),o.metadata=r[0].geometry.metadata,r[0].updateMatrixWorld(),r[0].matrixWorld.decompose(s,a,u),o.scale(u.x,u.y,u.z)}for(;n=r.pop();)if(n.updateMatrixWorld(),n.geometry.isBufferGeometry){if(n.geometry.attributes.position&&n.geometry.attributes.position.itemSize>2){var c=new THREE.Geometry;c.fromBufferGeometry(n.geometry),i.merge(c,n.matrixWorld),c.dispose()}}else i.merge(n.geometry,n.matrixWorld);return(t=new THREE.Matrix4).scale(e.scale),i.applyMatrix(t),i}function c(e){return e.attributes||(e=(new THREE.BufferGeometry).fromGeometry(e)),(e.attributes.position||{}).array||[]}i.Type=o,e.threeToCannon=i});
//# sourceMappingURL=three-pathfinding.umd.js.map
